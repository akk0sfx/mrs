<?xml version="1.0" ?>
<sdf version="1.9">
  <model name="diff_robot">
    <static>false</static>
    <pose>0 0 0 0 0 0</pose>

    <!-- ================== КОРПУС ================== -->
    <link name="base_link">
      <pose>0 0 0.12 0 0 0</pose>
      <inertial>
        <mass>12.0</mass>
        <inertia>
          <ixx>0.18</ixx><ixy>0</ixy><ixz>0</ixz>
          <iyy>0.24</iyy><iyz>0</iyz>
          <izz>0.30</izz>
        </inertia>
      </inertial>
      <visual name="base_vis">
        <geometry>
          <box><size>0.45 0.35 0.12</size></box>
        </geometry>
        <material>
          <ambient>0.08 0.12 0.18 1</ambient>
          <diffuse>0.10 0.18 0.26 1</diffuse>
        </material>
      </visual>
      <collision name="base_col">
        <geometry>
          <box><size>0.45 0.35 0.12</size></box>
        </geometry>
      </collision>
    </link>

    <!-- ================== КОЛЁСА ================== -->
    <link name="wheel_fl">
      <pose>0.16 0.15 0.07 1.57079632679 0 0</pose>
      <inertial>
        <mass>0.6</mass>
        <inertia>
          <ixx>0.0012</ixx><ixy>0</ixy><ixz>0</ixz>
          <iyy>0.0006</iyy><iyz>0</iyz>
          <izz>0.0012</izz>
        </inertia>
      </inertial>
      <visual name="vis">
        <geometry>
          <cylinder><radius>0.07</radius><length>0.05</length></cylinder>
        </geometry>
      </visual>
      <collision name="col">
        <geometry>
          <cylinder><radius>0.07</radius><length>0.05</length></cylinder>
        </geometry>
      </collision>
    </link>
    <joint name="wheel_fl_joint" type="revolute">
      <parent>base_link</parent>
      <child>wheel_fl</child>
      <axis>
        <xyz expressed_in="wheel_fl">0 0 1</xyz>
        <limit><lower>-1e16</lower><upper>1e16</upper></limit>
      </axis>
    </joint>

    <link name="wheel_fr">
      <pose>0.16 -0.15 0.07 1.57079632679 0 0</pose>
      <inertial>
        <mass>0.6</mass>
        <inertia>
          <ixx>0.0012</ixx><ixy>0</ixy><ixz>0</ixz>
          <iyy>0.0006</iyy><iyz>0</iyz>
          <izz>0.0012</izz>
        </inertia>
      </inertial>
      <visual name="vis">
        <geometry>
          <cylinder><radius>0.07</radius><length>0.05</length></cylinder>
        </geometry>
      </visual>
      <collision name="col">
        <geometry>
          <cylinder><radius>0.07</radius><length>0.05</length></cylinder>
        </geometry>
      </collision>
    </link>
    <joint name="wheel_fr_joint" type="revolute">
      <parent>base_link</parent>
      <child>wheel_fr</child>
      <axis>
        <xyz expressed_in="wheel_fr">0 0 1</xyz>
        <limit><lower>-1e16</lower><upper>1e16</upper></limit>
      </axis>
    </joint>

    <link name="wheel_rl">
      <pose>-0.16 0.15 0.07 1.57079632679 0 0</pose>
      <inertial>
        <mass>0.6</mass>
        <inertia>
          <ixx>0.0012</ixx><ixy>0</ixy><ixz>0</ixz>
          <iyy>0.0006</iyy><iyz>0</iyz>
          <izz>0.0012</izz>
        </inertia>
      </inertial>
      <visual name="vis">
        <geometry>
          <cylinder><radius>0.07</radius><length>0.05</length></cylinder>
        </geometry>
      </visual>
      <collision name="col">
        <geometry>
          <cylinder><radius>0.07</radius><length>0.05</length></cylinder>
        </geometry>
      </collision>
    </link>
    <joint name="wheel_rl_joint" type="revolute">
      <parent>base_link</parent>
      <child>wheel_rl</child>
      <axis>
        <xyz expressed_in="wheel_rl">0 0 1</xyz>
        <limit><lower>-1e16</lower><upper>1e16</upper></limit>
      </axis>
    </joint>

    <link name="wheel_rr">
      <pose>-0.16 -0.15 0.07 1.57079632679 0 0</pose>
      <inertial>
        <mass>0.6</mass>
        <inertia>
          <ixx>0.0012</ixx><ixy>0</ixy><ixz>0</ixz>
          <iyy>0.0006</iyy><iyz>0</iyz>
          <izz>0.0012</izz>
        </inertia>
      </inertial>
      <visual name="vis">
        <geometry>
          <cylinder><radius>0.07</radius><length>0.05</length></cylinder>
        </geometry>
      </visual>
      <collision name="col">
        <geometry>
          <cylinder><radius>0.07</radius><length>0.05</length></cylinder>
        </geometry>
      </collision>
    </link>
    <joint name="wheel_rr_joint" type="revolute">
      <parent>base_link</parent>
      <child>wheel_rr</child>
      <axis>
        <xyz expressed_in="wheel_rr">0 0 1</xyz>
        <limit><lower>-1e16</lower><upper>1e16</upper></limit>
      </axis>
    </joint>

    <!-- ================== СЕНСОРНАЯ МАЧТА ================== -->
    <link name="mast_link">
      <pose>0 0 0.30 0 0 0</pose>
      <inertial>
        <mass>0.08</mass>
        <inertia>
          <ixx>0.0004</ixx><ixy>0</ixy><ixz>0</ixz>
          <iyy>0.0004</iyy><iyz>0</iyz>
          <izz>0.0004</izz>
        </inertia>
      </inertial>
      <visual name="mast_vis">
        <geometry>
          <cylinder><radius>0.01</radius><length>0.36</length></cylinder>
        </geometry>
        <material>
          <ambient>0.18 0.18 0.18 1</ambient>
          <diffuse>0.22 0.22 0.22 1</diffuse>
        </material>
      </visual>
      <collision name="mast_col">
        <geometry>
          <cylinder><radius>0.01</radius><length>0.36</length></cylinder>
        </geometry>
      </collision>
    </link>
    <joint name="mast_fixed" type="fixed">
      <parent>base_link</parent>
      <child>mast_link</child>
    </joint>

    <!-- RGB-D камера на верхушке мачты -->
    <link name="camera_link">
      <pose>0 0 0.48 0 0 0</pose>
      <inertial>
        <mass>0.12</mass>
        <inertia>
          <ixx>0.0008</ixx><ixy>0</ixy><ixz>0</ixz>
          <iyy>0.0008</iyy><iyz>0</iyz>
          <izz>0.0008</izz>
        </inertia>
      </inertial>

      <sensor name="rgbd_camera" type="rgbd_camera">
        <pose>0 0 0 0 -1.57079632679 0</pose>
        <always_on>true</always_on>
        <update_rate>15</update_rate>
        <visualize>true</visualize>

        <topic>/camera/color/image</topic>
        <depth_topic>/camera/depth/image</depth_topic>
        <point_cloud_topic>/camera/depth/points</point_cloud_topic>
        <camera_info_topic>/camera/color/camera_info</camera_info_topic>
        <frame_id>camera_link</frame_id>

        <camera>
          <horizontal_fov>1.047</horizontal_fov>
          <image>
            <width>640</width>
            <height>480</height>
            <format>R8G8B8</format>
          </image>
          <clip>
            <near>0.05</near>
            <far>25</far>
          </clip>
        </camera>
      </sensor>

      <visual name="cam_body">
        <geometry>
          <box><size>0.06 0.06 0.04</size></box>
        </geometry>
        <material>
          <ambient>0.08 0.08 0.08 1</ambient>
          <diffuse>0.10 0.10 0.10 1</diffuse>
        </material>
      </visual>
      <collision name="cam_col">
        <geometry>
          <box><size>0.06 0.06 0.04</size></box>
        </geometry>
      </collision>
    </link>
    <joint name="camera_fixed" type="fixed">
      <parent>mast_link</parent>
      <child>camera_link</child>
    </joint>

    <!-- Лидар 2D (GPU Lidar для Harmonic) -->
    <link name="lidar_link">
      <pose>0.18 0 0.34 0 0 0</pose>
      <inertial>
        <mass>0.10</mass>
        <inertia>
          <ixx>0.0002</ixx><ixy>0</ixy><ixz>0</ixz>
          <iyy>0.0002</iyy><iyz>0</iyz>
          <izz>0.0002</izz>
        </inertia>
      </inertial>

      <sensor name="lidar" type="gpu_lidar">
        <pose>0 0 0 0 0 0</pose>
        <always_on>true</always_on>
        <update_rate>15</update_rate>
        <visualize>true</visualize>

        <topic>/scan</topic>
        <frame_id>lidar_link</frame_id>

        <lidar>
          <scan>
            <horizontal>
              <samples>720</samples>
              <resolution>1</resolution>
              <min_angle>-3.14159</min_angle>
              <max_angle>3.14159</max_angle>
            </horizontal>
          </scan>
          <range>
            <min>0.18</min>
            <max>18.0</max>
          </range>
        </lidar>
      </sensor>
    </link>
    <joint name="lidar_joint" type="fixed">
      <parent>base_link</parent>
      <child>lidar_link</child>
    </joint>

    <!-- IMU -->
    <link name="imu_link">
      <pose>0 0 0.20 0 0 0</pose>
      <inertial>
        <mass>0.05</mass>
        <inertia>
          <ixx>0.0001</ixx><ixy>0</ixy><ixz>0</ixz>
          <iyy>0.0001</iyy><iyz>0</iyz>
          <izz>0.0001</izz>
        </inertia>
      </inertial>
      <sensor name="imu" type="imu">
        <always_on>true</always_on>
        <update_rate>100</update_rate>
        <topic>/imu</topic>
        <frame_id>imu_link</frame_id>
      </sensor>
    </link>
    <joint name="imu_fixed" type="fixed">
      <parent>base_link</parent>
      <child>imu_link</child>
    </joint>

    <!-- Plugin: диф. привод -->
    <plugin name="gz::sim::systems::DiffDrive" filename="gz-sim-diff-drive-system">
      <left_joint>wheel_fl_joint</left_joint>
      <left_joint>wheel_rl_joint</left_joint>
      <right_joint>wheel_fr_joint</right_joint>
      <right_joint>wheel_rr_joint</right_joint>
      <wheel_separation>0.30</wheel_separation>
      <wheel_radius>0.07</wheel_radius>
      <topic>/cmd_vel</topic>
      <odom_topic>/odom</odom_topic>
      <frame_id>odom</frame_id>
      <child_frame_id>base_footprint</child_frame_id>
      <publish_odom>true</publish_odom>
    </plugin>

  </model>
</sdf>
